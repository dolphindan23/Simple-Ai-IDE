{
  "id": "stripe-payments",
  "name": "Stripe Payments",
  "version": "1.0.0",
  "description": "Adds Stripe checkout, webhook verification, billing pages, and subscription management",
  "tags": ["payments", "stripe", "webhooks", "billing"],
  "extends": ["base-node"],
  "variables": {
    "BILLING_ROUTE_PREFIX": { "default": "/v1/billing", "description": "API route prefix for billing endpoints" },
    "WEBHOOK_PATH": { "default": "/v1/billing/stripe/webhook", "description": "Stripe webhook endpoint path" }
  },
  "creates": {
    "files": [
      "src/integrations/stripe/client.ts",
      "src/integrations/stripe/webhook.ts",
      "src/routes/billing.ts",
      "src/billing/plans.ts",
      "docs/integrations/stripe.md"
    ],
    "endpoints": [
      "POST {{BILLING_ROUTE_PREFIX}}/stripe/checkout",
      "POST {{WEBHOOK_PATH}}",
      "GET {{BILLING_ROUTE_PREFIX}}/stripe/portal"
    ]
  },
  "requiresSecrets": ["STRIPE_SECRET_KEY", "STRIPE_WEBHOOK_SECRET"],
  "capabilitiesPatch": {
    "integrations": {
      "stripe": { 
        "status": "not_configured", 
        "mode": "test",
        "webhookPath": "{{WEBHOOK_PATH}}"
      }
    }
  },
  "postInstall": [
    { "type": "shell", "cmd": "npm install stripe" }
  ],
  "guardrails": {
    "recommendedImmutable": [
      "src/integrations/stripe/**",
      "src/routes/billing.ts"
    ],
    "ports": [],
    "networkAllowlistDomains": ["api.stripe.com"]
  }
}
